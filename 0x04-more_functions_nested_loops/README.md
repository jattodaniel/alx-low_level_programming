More neating, functions and loops
